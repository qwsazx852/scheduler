# 📖 智慧排班系統 - 完整使用手冊 (User Manual)

本文檔記錄系統的完整操作流程，包含從安裝、設定到自動化串接的步驟。

## 1. 安裝與啟動 (Installation & Startup)

### 📥 首次安裝
如果您是第一次下載專案：
```bash
git clone https://github.com/qwsazx852/scheduler.git
cd scheduler
pip install -r requirements.txt
chmod +x run.sh
```

### 🚀 啟動系統
我們提供了一鍵啟動腳本，請在終端機輸入：
```bash
./run.sh
```
啟動後，瀏覽器會自動開啟操作介面 (通常為 `http://localhost:8501`)。

---

## 2. 排班設定 (Configuration)

在進行排班前，請確保您的基礎資料正確。

### 👥 步驟一：員工設定 (Employee Settings)
1. 進入 **「員工設定」** 分頁。
2. **新增/編輯員工**：設定姓名、可上班星期。
3. **重要：角色設定 (Roles)**：
   - 務必將「組長」或「資深員工」的角色正確勾選。
   - 系統有 **「角色保留機制」**，會優先保留組長去填補只有組長能做的時段，避免浪費戰力。
4. **自動儲存**：您的任何修改都會即時自動存入 `config/config_employees.json`，無需擔心遺失。

### 🕒 步驟二：班別與規則 (Shifts & Rules)
1. 進入 **「班別設定」** 分頁。
2. 定義班別時間 (如 早班 A 07:00-14:00)。
3. **覆蓋規則 (Coverage Rules)**：
   - 這是排班的核心！請設定「某個時段」需要「多少人」以及「什麼角色」。
   - **範例**：設定 `07:00-12:00` 至少需要 1 位 `組長`。
   - 若您的人力不足以支付規則 (例如需要 11 小時組長，但只有 1 位組長)，系統會在排班後發出警示。
### ⚡ 進階：兩段式班別 (Split Shifts) NEW!
我們支援「兩段式班別」以符合餐飲業等實際需求。
- **設定方式**：在班別時間欄位使用「逗號」分隔。
- **範例**：`10:00-14:00,17:00-21:00`
- **系統處理**：
  - 系統會自動辨識並確認這兩個時段都有人上班。
  - 休息時間檢查（避免花花班）會依據第一段的開始時間來計算。
  - 甘特圖與覆蓋率檢查都會正確顯示空班時間。

---

## 3. 生成與檢視 (Generate & View)

### 📅 開始排班
1. 回到「排班儀表板」首頁。
2. 選擇 **年份** 與 **月份**。
3. 點擊 **「🚀 開始排班 (Start Scheduling)」**。
   - 系統會透過 AI 演算法進行計算，通常耗時 1-3 秒。

### 📊 檢視結果
排班完成後，您會看到三個分頁：

1. **📅 預設視圖 (By Date)**：
   - 傳統表格，顯示每天、每個班別是誰上班。
2. **👥 員工視圖 (By Employee)**：
   - 以員工為列，顯示每個人每天的班表（休假顯示 X）。
   - 適合檢查每個人的連續上班狀況。
3. **📊 統計報表 (Stats) ✨**：
   - **公平性檢查**：長條圖顯示每人的總班數。
   - 確認是否有勞逸不均的現象（系統會自動平衡，您可在此驗收）。

### 📥 匯出
- 點擊 **「下載 Excel」** 按鈕，即可取得完整的排班結果表格。

---

## 4. 自動化串接 (Automation - n8n)

本系統支援 API 模式，可與 n8n 完美整合。

### 🔌 啟動 API 伺服器
若要讓 n8n 連線，請在終端機啟動 API 模式：
```bash
./run.sh api
```
(伺服器會在 Port 8000 運行)

### 📡 n8n HTTP Request 設定
- **Method**: POST
- **URL**: `http://YOUR_SERVER_IP:8000/generate`
- **Body**: 傳入完整的 JSON 設定（包含員工、規則等）。

### 🧪 測試與除錯
- 您可以使用 **Simulator** 端點來測試 n8n 流程是否通順：
- **URL**: `http://YOUR_SERVER_IP:8000/simulate`
- **功能**：它會直接讀取您本地 `config/` 資料夾內的設定來排班，不需每次傳送巨大 JSON。
- **回傳內容**：包含 `schedule_flat` (清單) 與 `schedule_matrix` (包含休假 X)，方便 n8n 寫入 Google Sheets。

---

## 🛠️ 維護與除錯 (Maintenance)

- **專案結構**：所有核心代碼在 `src/`，設定檔在 `config/`。
- **清理垃圾**：若目錄變亂，執行 `./run.sh clean` 即可清理暫存檔。
- **版本控制**：本專案使用 Git Tags 管理日期版本 (如 `v2026.01.23`)。

---
**Made with Vibe Coding 🎩**
